<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="http://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.css">

<link rel="stylesheet" type="text/css" href="/css/navBar.css">
<link rel="stylesheet" type="text/css" href="/css/sidebar.css">

<script src="http://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.js"></script>

<script src="script/trumbowyg.min.js"></script>

<% include paritials/topbar.ejs %>
<% include paritials/sidebar.ejs %>

<style>
              .active {
			background-color: #51a1e2 !important;
		}
              .div-min-width
{
    min-width: 360px;
}
.scrollclass
{
    overflow:scroll;
}
.container-fluid
{
    margin-top:10px;
    margin-left:10px;
    margin-right:10px;
    width: 1315px;
}
#tagdiv
{
    border: 2px solid #2D312C;
    background-color: #2D312C;
    color: #fff;
    box-shadow: 0 0 10px rgba(0,0,0,0.6);
}
@media (min-width: 768px)
{
    #containerid
    {
        margin-left:50px;
    }
    
}
.form-inline
{
    display:block;
}

    </style>
 <center>
                                    <div id="delModal1" class="modal fade" role = "dialog" style="background:#404F65;opacity:.5;z-index:9999;">
                                        <div class="modal-dialog modal-sm" style="position:relative;top:35%!important;">
                                            <div id="move" class="modal-content" style="background:transparent;border:0;box-shadow:0px 0px 0px 0px">
                                                <div class="modal-header" style="border-bottom:0">
                                                    <h2 style="color:#FAFBFB" class="modal-title">Confirm Logout</h2>
                                                </div>
                                                <div class="modal-body">
                                                    <p style="color:white">Do you really want logout? </p>
                                                </div>
                                                <div class="modal-footer" style="border-top:0;text-align:center">
                                                    <button id="log" type="button" class="btn btn-default" style="background:#303F53;border:0;color:white;width:28%;height:15%">Yes</button>
                                                    <button type="button" class="btn btn-default" data-dismiss="modal" style="background:#303F53;border:0;color:white;width:28%;height:15%">No</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </center>
          <div id="viewscreen">
       <div id="rightview">
<center>
                                    <div id="delModal" class="modal fade" role = "dialog">
                                        <div class="modal-dialog modal-sm" style="position:relative;top:35%!important;">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h4 class="modal-title">Switch As User</h4>
                                                </div>
                                                <div class="modal-body">
                                                    <p>Do you really want switch state... </p>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-success">Yes</button>
                                                    <button type="button" class="btn btn-danger" data-dismiss="modal">No</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </center>
<div class="container-fluid div-min-width" id="containerid" style="padding:0">
                    <div class="row">
                        <div class = "col-lg-12 scrollclass" style="padding:0">
                            <div style="margin-right:20px;margin-left:20px;margin-top:1%">
                                <!-- MODAL DIV -->
                                <center>
                                    <div id="delModal" class="modal fade" role = "dialog">
                                        <div class="modal-dialog modal-sm" style="position:relative;top:35%!important;">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h4 class="modal-title">Delete Tag!</h4>
                                                </div>
                                                <div class="modal-body">
                                                    <p>Are you Sure you want to delete </p>
                                                </div>
                                                <div class="modal-footer">
                                                    <button id="Yes" type="button" class="btn btn-success">Yes</button>
                                                    <button type="button" class="btn btn-danger" data-dismiss="modal">No</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </center>
                                <!--AFTER MODAL DIVS -->
                                <div class="form-control" id="tagdiv" style="float:left;width:100px;font-weight:bold">
                                    Tags List
                                </div>

                                <button class = "btn btn-default" id="refresh" style="float:right;background-color:#2D312C;color:#fff" onclick="loadFromServer()">
                                    <span><i class="fa fa-refresh"></i></span>
                                    Refresh
                                </button>
                                <br>
                                <br>
                                <br>
                                <div class="table-responsive">
                                    <table class="table table-striped table-condensed table-hover table-bordered" id="tags-table" >
                                        <thead>
                                            <tr>
                                                <th class="text-center">Tag Name</th>
                                                <th >Created By</th>
                                                <th >Create Date</th>
                                                <th >Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tbody">
                                        </tbody>
                                    </table>
                                </div>
                        </div>
                    </div>
                    </div>
                </div>
</div>
    </div>
    <script type="text/javascript">
loadFromServer();
function loadFromServer()
{
    var t=document.getElementById('tbody');
    tbody.innerHTML="";
    var filename = '/getTagTable';
    var request = new XMLHttpRequest();
    request.open('GET',filename);
    request.send();
    request.onload = function()
    {
        console.log(request.responseText);
        myuserArr = JSON.parse(request.responseText);
        if(myuserArr.length == 0)
        myuserId = 1;
        else {
            for(i in myuserArr)
            {
                addToDom(myuserArr[i]);
            }
            update_table();
        }
    }
}
function addToDom(ob)
{
    console.log(ob.tagname);
    console.log(ob.createdby);
    console.log(ob.date);
    if(1)
        {
    var row = document.createElement("tr");
    var col1 = document.createElement("td");
    var col2 = document.createElement("td");
    var col3 = document.createElement("td");
    var col4 = document.createElement("td");
    col1.setAttribute("class","text-center");
    col1.innerHTML = ob.tagname;
    col2.innerHTML = ob.createdby;
    col3.innerHTML = ob.createddate;

    col4.setAttribute("class","text-center");
    var delbtn = document.createElement("button");
    delbtn.setAttribute("class","btn btn-sm");
    delbtn.setAttribute("style","margin-top:0;background-color:#2D312C;color:#fff")
    var span = document.createElement("span");
    span.setAttribute("class","fa fa-trash");
    delbtn.appendChild(span);
    col4.appendChild(delbtn);
    row.appendChild(col1);
    row.appendChild(col2);
    row.appendChild(col3);
    row.appendChild(col4);

    tbody.appendChild(row);
            delbtn.onclick=function()
            {
            var obj1=ob;
            $.confirm({
            title: 'Delete Tag!',
            content: "Are you sure you want to delete ",
            buttons: {
                'Yes': {
                    btnClass: 'btn-success',
                    action: function () 
                    {
                        console.log(obj1);
                        var request = new XMLHttpRequest();
                        request.open('POST','/deletetag');
                        request.setRequestHeader("Content-Type","application/json");
                        request.send(JSON.stringify({_id:obj1._id}));
                    }
                    }
                },
                'No': {btnClass: 'btn-danger',}
            })
        }

            /*
                console.log("hello");
                var yes=document.getElementById("Yes");
                yes.onclick=function()
                {
                    var ob1=new Object();
                    ob1.id=ob._id;
                    ob1.del="0";
                    console.log(ob1);
                    var xhr=new XMLHttpRequest();
        xhr.open("POST","/tagdelete");
        xhr.setRequestHeader("Content-Type","application/json");
        xhr.send(JSON.stringify(ob1));
        xhr.addEventListener("load",function(event)
                            {
            if(xhr.responseText=="1")
                alert("Tag deleted Successfully");
            window.location="/taglist";
        });
                    
                }*/
            }
        }


function update_table()
   {
     $(document).ready(function() {
       $('#tags-table').DataTable();
     })
   }
</script>